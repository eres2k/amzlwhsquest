<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMZL WHS QUEST - DVI1 Portal</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap');

        :root {
            --neon-green: #00ff00;
            --neon-pink: #ff00ff;
            --warning-yellow: #eab308;
            --corp-blue: #0000a0;
            --bg-dark: #050505;
            --glass: rgba(0, 20, 0, 0.75);
            --terminal-gray: #1a1a1a;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-dark);
            font-family: 'VT323', monospace;
            color: #eee;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- BACKGROUND CANVAS --- */
        #bg-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; pointer-events: none; opacity: 0.4;
        }

        /* --- CRT EFFECTS --- */
        body::after {
            content: " "; display: block; position: fixed;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 4px; z-index: 999; pointer-events: none;
        }

        /* --- TURN ON ANIMATION --- */
        .crt-turn-on {
            animation: turn-on 2s ease-out forwards;
        }
        @keyframes turn-on {
            0% { transform: scale(1, 0.002); opacity: 0; filter: brightness(30); }
            20% { transform: scale(1, 0.002); opacity: 1; }
            50% { transform: scale(1, 1.1); filter: brightness(5); }
            100% { transform: scale(1, 1); filter: brightness(1); }
        }

        .container {
            max-width: 1000px; margin: 0 auto; padding: 20px;
            position: relative; z-index: 1; width: 100%;
        }

        /* --- HEADER --- */
        header {
            text-align: center; margin-bottom: 20px;
            border-bottom: 4px solid var(--neon-green); padding-bottom: 20px;
        }

        h1 {
            font-family: 'Press Start 2P', cursive; color: var(--warning-yellow);
            font-size: clamp(1.5rem, 4vw, 3rem);
            text-shadow: 4px 4px var(--corp-blue); margin: 0; line-height: 1.5;
            position: relative;
        }

        /* GLITCH EFFECT */
        .glitch { position: relative; display: inline-block; }
        .glitch::before, .glitch::after {
            content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        }
        .glitch::before { left: 2px; text-shadow: -1px 0 red; clip: rect(44px, 450px, 56px, 0); animation: glitch-anim 5s infinite linear alternate-reverse; }
        .glitch::after { left: -2px; text-shadow: -1px 0 blue; clip: rect(44px, 450px, 56px, 0); animation: glitch-anim2 5s infinite linear alternate-reverse; }

        @keyframes glitch-anim {
            0% { clip: rect(10px, 9999px, 30px, 0); } 20% { clip: rect(80px, 9999px, 100px, 0); }
            40% { clip: rect(40px, 9999px, 60px, 0); } 60% { clip: rect(20px, 9999px, 10px, 0); }
            80% { clip: rect(60px, 9999px, 50px, 0); } 100% { clip: rect(90px, 9999px, 90px, 0); }
        }
        @keyframes glitch-anim2 {
            0% { clip: rect(50px, 9999px, 10px, 0); } 20% { clip: rect(20px, 9999px, 80px, 0); }
            40% { clip: rect(90px, 9999px, 20px, 0); } 60% { clip: rect(10px, 9999px, 50px, 0); }
            80% { clip: rect(30px, 9999px, 70px, 0); } 100% { clip: rect(60px, 9999px, 40px, 0); }
        }

        .subtitle {
            color: var(--neon-green); font-size: 1.5rem; letter-spacing: 2px;
            text-transform: uppercase; animation: blink 1s infinite;
        }

        /* --- GEMINI LIVE FEED --- */
        #live-feed {
            background: rgba(0,0,0,0.8); border: 1px solid var(--neon-green);
            padding: 10px; margin-bottom: 20px; font-family: 'VT323', monospace;
            color: var(--neon-green); box-shadow: 0 0 10px var(--neon-green);
            min-height: 60px; display: flex; align-items: center; justify-content: center;
            text-align: center; font-size: 1.2rem; overflow: hidden;
            position: relative; white-space: nowrap;
        }

        .ticker-track {
            display: inline-block; white-space: nowrap; padding-left: 100%;
            animation: ticker-scroll var(--scroll-duration, 40s) linear infinite;
        }

        @keyframes ticker-scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        
        .loading-dots:after { content: '.'; animation: dots 1s steps(5, end) infinite; }
        @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60% { content: '...'; } 80%, 100% { content: ''; } }

        section {
            background: var(--glass); border: 2px solid #333; margin-bottom: 30px;
            padding: 20px; box-shadow: 8px 8px 0px black; backdrop-filter: blur(2px);
            transition: transform 0.2s;
        }
        section:hover { transform: translate(-2px, -2px); box-shadow: 10px 10px 0px var(--neon-green); border-color: var(--neon-green); }

        h2 { font-family: 'Press Start 2P', cursive; font-size: 1.2rem; color: var(--neon-pink); border-bottom: 2px dashed #555; padding-bottom: 10px; margin-top: 0; }

        p { font-size: 1.1rem; line-height: 1.6; margin-bottom: 15px; }
        strong { color: var(--warning-yellow); }

        .char-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; }
        .char-card { background: rgba(0,0,0,0.8); border: 1px solid #444; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .char-card h3 { color: var(--warning-yellow); margin: 0 0 5px 0; font-family: 'Press Start 2P'; font-size: 0.9rem;}
        .card-content { display: flex; align-items: center; gap: 12px; }
        .card-content img, .card-content canvas { image-rendering: pixelated; width: 72px; height: 72px; border: 2px solid #222; background: #050505; }
        .char-text { flex: 1; display: flex; flex-direction: column; gap: 6px; }
        .char-role { color: #00ffff; font-size: 1rem; text-transform: uppercase; margin: 0; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .char-desc { font-size: 0.9rem; color: #ccc; line-height: 1.4; flex-grow: 1; margin: 0;}
        .char-stat { margin: 0; font-size: 0.8rem; color: #aaa; font-style: italic; }

        .play-btn {
            background: red; color: white; font-family: 'Press Start 2P';
            font-size: 1.5rem; padding: 25px 50px; text-decoration: none;
            border: 4px solid white; box-shadow: 0 0 20px red;
            display: inline-block; animation: pulse 1.5s infinite;
            cursor: pointer; text-transform: uppercase; position: relative;
            overflow: hidden;
        }
        .play-btn:hover { background: #ff4444; transform: scale(1.1); box-shadow: 0 0 40px red; }
        
        /* Shine effect on button */
        .play-btn::after {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shine 3s infinite;
        }

        /* --- AI UTILITIES STYLES --- */
        .ai-tools-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 20px; 
        }
        @media (max-width: 600px) { .ai-tools-grid { grid-template-columns: 1fr; } }
        
        .ai-tool { 
            background: var(--terminal-gray); 
            border: 1px solid #444; 
            padding: 15px; 
            position: relative; 
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100%;
        }
        .ai-tool h3 { font-size: 1rem; color: var(--neon-green); margin-top: 0; }
        .ai-tool p { flex-grow: 1; } /* Pushes content down */

        .ai-controls {
            margin-top: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .ai-btn {
            background: var(--corp-blue); color: white; border: 2px solid white;
            font-family: 'Press Start 2P'; font-size: 0.7rem; padding: 10px;
            cursor: pointer; width: 100%; transition: 0.2s;
        }
        .ai-btn:hover { background: #0044cc; transform: translateY(-2px); }
        .ai-btn:disabled { background: #555; cursor: not-allowed; border-color: #777; }

        .ai-output {
            margin-top: 15px; padding: 10px; background: #000; border: 1px dashed var(--neon-pink);
            min-height: 60px; font-size: 0.9rem; color: var(--neon-pink); white-space: pre-wrap;
        }

        @keyframes shine { 0% { left: -100%; } 20% { left: 100%; } 100% { left: 100%; } }
        @keyframes blink { 50% { opacity: 0; } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(255, 0, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); } }
    </style>
</head>
<body class="crt-turn-on">

<canvas id="bg-canvas"></canvas>

<div class="container">
    <header>
        <h1><span class="glitch" data-text="AMZL WHS QUEST">AMZL WHS QUEST</span><br><span style="font-size:0.5em; color:#fff;">v12.2.5 - DVI1 EDITION</span></h1>
        <div class="subtitle">> WHS COORDINATOR TERMINAL_</div>
    </header>

    <div id="live-feed">
        <span id="feed-track" class="ticker-track">ESTABLISHING SECURE LINK TO AMAZON HQ...<span class="loading-dots"></span></span>
    </div>

    <div style="text-align: center; margin: 60px 0;">
        <a href="AMZLWHSQUEST122.html" class="play-btn">▶ START SHIFT</a>
        <p style="color: #aaa; font-size: 0.8rem; margin-top: 15px;">(INPUT: KEYBOARD | REWARD: PIZZA PARTY)</p>
    </div>

    <main>
        <section>
            <h2>> MISSION BRIEFING</h2>
            <p><strong>IDENTITY:</strong> Tier 1 WHS Coordinator</p>
            <p><strong>LOCATION:</strong> Delivery Station DVI1 (Vienna)</p>
            <p><strong>STATUS:</strong> Caffeinated but Panicked</p>
            <p>Welcome to DVI1. Your mission, should you choose to accept it (you have no choice, you signed the contract), is to survive a standard shift. The floor is a minefield of blocked exits, rogue pallet jacks, and Associates who believe safety shoes are "optional fashion statements".</p>
            <p>The Ops Managers are obsessed with TPH (Throughput Per Hour). They will throw crazy production requests at you. <strong>Do not fold.</strong> Find the 5 hazardous crimes against safety, audit the floor, and "take care" of the Visitor before the VOA board catches fire.</p>
        </section>

        <section>
            <h2>> THE SQUAD</h2>
            <div class="char-grid">
                <div class="char-card">
                    <h3>CARRIE</h3>
                    <div class="card-content">
                        <div class="char-portrait" data-sprite="carrie"></div>
                        <div class="char-text">
                            <div class="char-role">The 5S Monk</div>
                            <p class="char-desc">Can detect a piece of floor tape misaligned by 1mm from across the cluster. Uses meditation to tolerate Ops meetings.</p>
                            <p class="char-stat">Weapon: The Label Maker</p>
                        </div>
                    </div>
                </div>
                <div class="char-card">
                    <h3>NEVENA</h3>
                    <div class="card-content">
                        <div class="char-portrait" data-sprite="nevena"></div>
                        <div class="char-text">
                            <div class="char-role">The Worrier</div>
                            <p class="char-desc">The Safety Oracle. She predicts accidents before they happen. Always carries emergency Palatschinken for stress eating.</p>
                            <p class="char-stat">Weapon: The Clipboard of Doom</p>
                        </div>
                    </div>
                </div>
                <div class="char-card">
                    <h3>JOAO</h3>
                    <div class="card-content">
                        <div class="char-portrait" data-sprite="joao"></div>
                        <div class="char-text">
                            <div class="char-role">The Siren</div>
                            <p class="char-desc">His voice is louder than the fire alarm. Associates hear his safety warnings in their dreams. Runs on pure espresso.</p>
                            <p class="char-stat">Weapon: Sonic Shout</p>
                        </div>
                    </div>
                </div>
                <div class="char-card">
                    <h3>ROMAN</h3>
                    <div class="card-content">
                        <div class="char-portrait" data-sprite="roman"></div>
                        <div class="char-text">
                            <div class="char-role">The Ghost</div>
                            <p class="char-desc">He is everywhere and nowhere. Hazards seem to fix themselves out of fear when he enters the room.</p>
                            <p class="char-stat">Weapon: Stealth Audit</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2>> THREAT DATABASE (VISITORS)</h2>
            <div class="char-grid">
                <div class="char-card" style="border-color: #ff4444;">
                    <h3 style="color: #ff4444;">LABOUR INSPECTOR</h3>
                    <div class="card-content">
                        <div class="char-portrait" data-sprite="boss_inspector"></div>
                        <div class="char-text">
                            <div class="char-role" style="color: #ff4444;">The Enforcer</div>
                            <p class="char-desc">Hi-vis crusader with two clipboards. Signs nothing unless the exit lines are laser straight.</p>
                        </div>
                    </div>
                </div>
                <div class="char-card" style="border-color: #ff4444;">
                    <h3 style="color: #ff4444;">COMPLIANCE</h3>
                    <div class="card-content">
                        <div class="char-portrait" data-sprite="boss_compliance"></div>
                        <div class="char-text">
                            <div class="char-role" style="color: #ff4444;">The Auditor</div>
                            <p class="char-desc">Teal suit, SOP binder, and endless patience. Will quote the correct version in her sleep.</p>
                        </div>
                    </div>
                </div>
                <div class="char-card" style="border-color: #ff4444;">
                    <h3 style="color: #ff4444;">SEBASTIAN</h3>
                    <div class="card-content">
                        <div class="char-portrait" data-sprite="boss_sebastian"></div>
                        <div class="char-text">
                            <div class="char-role" style="color: #ff4444;">THE Station Commander</div>
                            <p class="char-desc">Obsessed with rates. Believes "Safety Stops" are a myth invented to lower volume.</p>
                        </div>
                    </div>
                </div>
                <div class="char-card" style="border-color: #ff4444;">
                    <h3 style="color: #ff4444;">REGIONAL OPS MGR</h3>
                    <div class="card-content">
                        <div class="char-portrait" data-sprite="boss_regional"></div>
                        <div class="char-text">
                            <div class="char-role" style="color: #ff4444;">The Executive</div>
                            <p class="char-desc">Arrives with gold tie energy and KPI thunder. If rates dip, expect a full audit storm.</p>
                        </div>
                    </div>
                </div>
                <div class="char-card" style="border-color: #ff4444;">
                    <h3 style="color: #ff4444;">AVETTA AI</h3>
                    <div class="card-content">
                        <div class="char-portrait" data-sprite="boss_avetta"></div>
                        <div class="char-text">
                            <div class="char-role" style="color: #ff4444;">The Algorithm</div>
                            <p class="char-desc">A sentient cloud platform. It knows you forgot your gloves. It is watching.</p>
                        </div>
                    </div>
                </div>
                <div class="char-card" style="border-color: #ff4444;">
                    <h3 style="color: #ff4444;">JELENA "JELLY"</h3>
                    <div class="card-content">
                        <div class="char-portrait" data-sprite="boss_jelly"></div>
                        <div class="char-text">
                            <div class="char-role" style="color: #ff4444;">The HR Sentinel</div>
                            <p class="char-desc">From HR and always smiling, until policies are ignored. Remembers every infraction.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- NEW AI SECTION (MOVED TO BOTTOM) -->
        <section>
            <h2>> WORKER UTILITIES</h2>
            <div class="ai-tools-grid">
                <!-- TOOL 1: EXCUSE GENERATOR -->
                <div class="ai-tool">
                    <div>
                        <h3>THE EXCUSE GENERATOR</h3>
                        <p style="font-size:0.8rem; color:#ccc;">Missed a TPH goal? Need to explain why you were in the breakroom for 17 minutes? Let the tool fabricate a technically plausible excuse.</p>
                    </div>
                    <div class="ai-controls">
                        <!-- ADDED INPUT FIELD HERE -->
                        <input type="text" id="excuse-input" placeholder="e.g. late for shift" style="width:100%; background:#222; border:1px solid #555; color:white; font-family:'VT323'; padding:5px;">
                        <button class="ai-btn" onclick="generateExcuse()" id="btn-excuse">GENERATE EXCUSE</button>
                        <div class="ai-output" id="out-excuse">// WAITING FOR INPUT...</div>
                    </div>
                </div>

                <!-- TOOL 2: OPS SPEAK TRANSLATOR -->
                <div class="ai-tool">
                    <div>
                        <h3>OPS SPEAK TRANSLATOR</h3>
                        <p style="font-size:0.8rem; color:#ccc;">Translate your complaints into "High Performance" corporate jargon that managers love.</p>
                    </div>
                    <div class="ai-controls">
                        <input type="text" id="translate-input" placeholder="e.g. I hate this job" style="width:100%; background:#222; border:1px solid #555; color:white; font-family:'VT323'; padding:5px;">
                        <button class="ai-btn" onclick="translateSpeak()" id="btn-translate">TRANSLATE</button>
                        <div class="ai-output" id="out-translate" style="color: #00ffff; border-color: #00ffff;">// WAITING FOR INPUT...</div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>© 2025 ERWIN ESENER PRODUCTIONS // WHS MEU // DVI1 VIENNA //</p>
    </footer>
</div>

<script>
    // --- 1. RETRO GRID BACKGROUND ANIMATION ---
    const canvas = document.getElementById('bg-canvas');
    const ctx = canvas.getContext('2d');
    let width, height;
    
    function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    let offset = 0;
    function animateGrid() {
        ctx.fillStyle = '#050505';
        ctx.fillRect(0, 0, width, height);
        
        // Horizon line
        const horizon = height * 0.4;
        
        // Vertical lines (Perspective)
        ctx.strokeStyle = 'rgba(0, 255, 0, 0.2)';
        ctx.lineWidth = 1;
        ctx.beginPath();
        const cx = width / 2;
        for(let i = -20; i <= 20; i++) {
            const x = cx + (i * 100); // Spread at bottom
            ctx.moveTo(cx, horizon); // Converge at horizon (vanishing point)
            ctx.lineTo(x * 4, height); // Spread out
        }
        ctx.stroke();

        // Horizontal lines (Moving towards viewer)
        offset = (offset + 0.5) % 20;
        for(let i = 0; i < 40; i++) {
            let y = horizon + Math.pow(i, 2.5) + offset; // Exponential spacing for depth
            if (y > height) continue;
            
            let alpha = (y - horizon) / (height - horizon); // Fade in near horizon
            ctx.strokeStyle = `rgba(0, 255, 0, ${alpha * 0.3})`;
            
            ctx.beginPath();
            ctx.moveTo(0, y);
            ctx.lineTo(width, y);
            ctx.stroke();
        }
        
        requestAnimationFrame(animateGrid);
    }
    animateGrid();

    // --- 2. KEY FETCHING (NEW) ---
    let apiKey = null;

    async function fetchApiKeyFromNetlify() {
        try {
            // This endpoint must exist in your Netlify functions folder
            const res = await fetch('/.netlify/functions/get-gemini-key', { cache: 'no-store' });
            if (!res.ok) throw new Error(`Netlify key endpoint returned ${res.status}`);
            const data = await res.json();
            const key = (data && data.apiKey ? String(data.apiKey) : '').trim();
            if (!key) throw new Error('No apiKey field in Netlify response');
            apiKey = key;
            console.log("SECURE LINK ESTABLISHED. KEY LOADED.");
            return apiKey;
        } catch (err) {
            console.error("FAILED TO LOAD KEY:", err);
            return null;
        }
    }

    // --- 3. GEMINI API INTEGRATION ---
    const defaultMessages = [
        "ATTENTION DVI1: IF YOU CAN READ THIS, YOU'RE NOT MOVING PALLETS FAST ENOUGH.",
        "ATTENTION DVI1: TPH GOAL UPDATED TO WHATEVER IS HIGHER THAN CURRENT. PLEASE COMPLY.",
        "ATTENTION DVI1: BREAKS ARE LIKE UNICORNS. HEARD OFTEN, RARELY SEEN.",
        "ATTENTION DVI1: REMEMBER, SAFETY FIRST, BUT ALSO SECOND, THIRD, AND MAYBE FOURTH.",
        "ATTENTION DVI1: LOST A RACK? PLEASE FILE A TICKET WITH FACILITIES AND YOUR THERAPIST.",
        "ATTENTION DVI1: OPS SAYS WE'RE FAMILY. FAMILY DOES 60 TPH, RIGHT?",
        "ATTENTION DVI1: SAFETY SHOES ARE NOT " +
            "A CONCEPT; THEY ARE THE ONLY THING BETWEEN YOU AND A ROGUE PALLET JACK.",
        "ATTENTION DVI1: WE TRACK TOT SO WELL WE'RE CONSIDERING ADDING IT TO YOUR DNA."
    ];

    const aiMessages = [];
    const maxAiMessages = 6;

    function renderTicker() {
        const track = document.getElementById('feed-track');
        const separator = "  ⚡  ";

        const priorityMessages = aiMessages.flatMap(msg => [msg, msg]); // Double AI lines to boost frequency
        const combinedMessages = (priorityMessages.length ? priorityMessages : [])
            .concat(defaultMessages);

        const text = combinedMessages.join(separator);
        track.innerText = text + separator + text;

        const duration = Math.max(25, Math.min(90, text.length / 1.8));
        track.style.setProperty('--scroll-duration', `${duration}s`);
    }

    function pushAiMessage(text) {
        if (!text) return;
        aiMessages.unshift(text);
        if (aiMessages.length > maxAiMessages) aiMessages.pop();
        renderTicker();
    }

    async function callGemini(prompt) {
        if (!apiKey) await fetchApiKeyFromNetlify();
        if (!apiKey) return null;

        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });
            const data = await response.json();
            return data.candidates?.[0]?.content?.parts?.[0]?.text;
        } catch (e) {
            console.error(e);
            return null;
        }
    }

    async function fetchAnnouncement() {
        const track = document.getElementById('feed-track');
        track.innerText = "CONNECTING TO HQ...";

        await fetchApiKeyFromNetlify(); // Ensure key is loaded

        if (!apiKey) { renderTicker(); return; }

        const prompt = "Write a single, short (max 15 words), funny, cynical, dystopic announcement for an Amazon logistics warehouse worker. Mention safety shoes, TOT, or brutal rates. Use ALL CAPS. Start with 'ATTENTION:'.";
        const text = await callGemini(prompt);

        if(text) pushAiMessage(text);
        else renderTicker();
    }

    // --- 4. NEW AI TOOLS ---
    async function generateExcuse() {
        const out = document.getElementById('out-excuse');
        const btn = document.getElementById('btn-excuse');
        const input = document.getElementById('excuse-input').value; // GET INPUT
        
        btn.disabled = true;
        btn.innerText = "CALCULATING...";
        out.innerText = "// ACCESSING MAINFRAME...";
        
        // DEFAULT TOPIC IF EMPTY
        let topic = "having low rates";
        if (input && input.trim() !== "") {
            topic = `the issue: "${input}"`;
        }
        
       const prompt = `Invent a technically plausible, realistic excuse based on this short input: "${input}". Max 25 Words. Amazon related with humour.`;
        const text = await callGemini(prompt);
        
        if (text) out.innerText = "> " + text;
        else out.innerText = "> ERROR: EXCUSE MODULE OFFLINE. TRY TELLING THE TRUTH (NOT RECOMMENDED).";
        
        btn.disabled = false;
        btn.innerText = "GENERATE EXCUSE";
    }

    async function translateSpeak() {
        const input = document.getElementById('translate-input').value;
        const out = document.getElementById('out-translate');
        const btn = document.getElementById('btn-translate');
        
        if (!input) { out.innerText = "> ERROR: NO INPUT DETECTED."; return; }

        btn.disabled = true;
        btn.innerText = "OPTIMIZING...";
        out.innerText = "// APPLYING SYNERGY...";
        
        const prompt = `Translate this worker complaint: "${input}" into overly positive, corporate, Amazon-style management speak. Max 25 words.`;
        const text = await callGemini(prompt);
        
        if (text) out.innerText = "> " + text;
        else out.innerText = "> ERROR: TRANSLATION FAILED.";
        
        btn.disabled = false;
        btn.innerText = "TRANSLATE";
    }

    // --- 5. PIXEL PORTRAITS ---
    const spritePainters = {
        carrie: ctx => {
            ctx.fillStyle = '#fcd34d'; ctx.fillRect(3,1,10,4); ctx.fillRect(2,3,2,8);
            ctx.fillStyle = '#38bdf8'; ctx.fillRect(4,2,8,2);
            ctx.fillStyle = '#ffcc99'; ctx.fillRect(5,5,6,5);
            ctx.fillStyle = '#000'; ctx.fillRect(6,7,1,1); ctx.fillRect(9,7,1,1);
            ctx.fillStyle = '#a855f7'; ctx.fillRect(3,10,10,6);
            ctx.fillStyle = '#facc15'; ctx.fillRect(7,12,2,2);
            ctx.fillStyle = '#1e3a8a'; ctx.fillRect(5,15,2,1); ctx.fillRect(9,15,2,1);
        },
        nevena: ctx => {
            ctx.fillStyle = '#1f2937'; ctx.fillRect(3,2,10,4); ctx.fillRect(2,4,2,6);
            ctx.fillStyle = '#14b8a6'; ctx.fillRect(4,3,8,2);
            ctx.fillStyle = '#f5c89a'; ctx.fillRect(5,6,6,5);
            ctx.fillStyle = '#000'; ctx.fillRect(6,8,1,1); ctx.fillRect(9,8,1,1);
            ctx.fillStyle = '#7f1d1d'; ctx.fillRect(3,11,10,5);
            ctx.fillStyle = '#9ca3af'; ctx.fillRect(4,12,2,2); ctx.fillRect(10,12,2,2);
            ctx.fillStyle = '#334155'; ctx.fillRect(5,15,2,1); ctx.fillRect(9,15,2,1);
        },
        joao: ctx => {
            ctx.fillStyle = '#166534'; ctx.fillRect(4,1,8,3); ctx.fillRect(6,0,4,1);
            ctx.fillStyle = '#f0a16b'; ctx.fillRect(5,4,6,5);
            ctx.fillStyle = '#6b7280'; ctx.fillRect(4,9,8,1);
            ctx.fillStyle = '#000'; ctx.fillRect(6,6,1,1); ctx.fillRect(9,6,1,1);
            ctx.fillStyle = '#fb923c'; ctx.fillRect(3,10,10,6);
            ctx.fillStyle = '#0ea5e9'; ctx.fillRect(4,12,2,2); ctx.fillRect(10,12,2,2);
            ctx.fillStyle = '#7c2d12'; ctx.fillRect(5,15,2,1); ctx.fillRect(9,15,2,1);
        },
        roman: ctx => {
            ctx.fillStyle = '#9ca3af'; ctx.fillRect(3,1,10,4); ctx.fillRect(2,3,2,5);
            ctx.fillStyle = '#0f172a'; ctx.fillRect(4,3,8,3);
            ctx.fillStyle = '#f5d0a0'; ctx.fillRect(5,6,6,5);
            ctx.fillStyle = '#000'; ctx.fillRect(6,8,1,1); ctx.fillRect(9,8,1,1);
            ctx.fillStyle = '#1e293b'; ctx.fillRect(3,11,10,5);
            ctx.fillStyle = '#e5e7eb'; ctx.fillRect(7,12,2,2);
            ctx.fillStyle = '#0b1224'; ctx.fillRect(5,15,2,1); ctx.fillRect(9,15,2,1);
        },
        boss_manager: ctx => {
            ctx.fillStyle = '#0f172a'; ctx.fillRect(2,1,12,5);
            ctx.fillStyle = '#ffcc99'; ctx.fillRect(4,6,8,5);
            ctx.fillStyle = '#111827'; ctx.fillRect(3,10,10,6);
            ctx.fillStyle = '#ef4444'; ctx.fillRect(7,11,2,3);
            ctx.fillStyle = '#000'; ctx.fillRect(6,8,1,1); ctx.fillRect(9,8,1,1);
        },
        boss_inspector: ctx => {
            ctx.fillStyle = '#9ca3af'; ctx.fillRect(3,1,10,4);
            ctx.fillStyle = '#f5cba7'; ctx.fillRect(4,5,8,5);
            ctx.fillStyle = '#000'; ctx.fillRect(5,7,2,1); ctx.fillRect(9,7,2,1);
            ctx.fillStyle = '#facc15'; ctx.fillRect(3,10,10,6);
            ctx.fillStyle = '#0ea5e9'; ctx.fillRect(4,11,2,2); ctx.fillRect(10,11,2,2);
            ctx.fillStyle = '#1f2937'; ctx.fillRect(5,15,2,1); ctx.fillRect(9,15,2,1);
        },
        boss_compliance: ctx => {
            ctx.fillStyle = '#0b162a'; ctx.fillRect(3,1,10,4);
            ctx.fillStyle = '#ffcc99'; ctx.fillRect(5,5,6,5);
            ctx.fillStyle = '#000'; ctx.fillRect(6,7,1,1); ctx.fillRect(9,7,1,1);
            ctx.fillStyle = '#22d3ee'; ctx.fillRect(3,10,10,6);
            ctx.fillStyle = '#14b8a6'; ctx.fillRect(7,11,2,3);
            ctx.fillStyle = '#c084fc'; ctx.fillRect(5,15,2,1); ctx.fillRect(9,15,2,1);
        },
        boss_regional: ctx => {
            ctx.fillStyle = '#312e81'; ctx.fillRect(2,1,12,5);
            ctx.fillStyle = '#f5d0a0'; ctx.fillRect(4,6,8,5);
            ctx.fillStyle = '#000'; ctx.fillRect(6,8,1,1); ctx.fillRect(9,8,1,1);
            ctx.fillStyle = '#581c87'; ctx.fillRect(3,10,10,6);
            ctx.fillStyle = '#fbbf24'; ctx.fillRect(7,11,2,3);
            ctx.fillStyle = '#cbd5e1'; ctx.fillRect(5,15,2,1); ctx.fillRect(9,15,2,1);
        },
        boss_sebastian: ctx => {
            ctx.fillStyle = '#f5d0a0'; ctx.fillRect(5,2,6,6);
            ctx.fillStyle = '#1d4ed8'; ctx.fillRect(3,8,10,1);
            ctx.fillStyle = '#2563eb'; ctx.fillRect(2,9,12,6);
            ctx.fillStyle = '#f97316'; ctx.fillRect(7,11,2,2);
            ctx.fillStyle = '#000'; ctx.fillRect(6,4,1,1); ctx.fillRect(9,4,1,1);
            ctx.fillStyle = '#eab308'; ctx.fillRect(3,1,10,2);
        },
        boss_jelly: ctx => {
            ctx.fillStyle = '#ec4899'; ctx.fillRect(3,1,10,5);
            ctx.fillStyle = '#ffcc99'; ctx.fillRect(4,5,8,5);
            ctx.fillStyle = '#000'; ctx.fillRect(5,7,2,1); ctx.fillRect(9,7,2,1);
            ctx.fillStyle = '#22c55e'; ctx.fillRect(3,10,10,6);
            ctx.fillStyle = '#f5f5f5'; ctx.fillRect(6,12,4,2);
            ctx.fillStyle = '#10b981'; ctx.fillRect(2,9,2,2);
        },
        boss_avetta: ctx => {
            ctx.fillStyle = '#0f172a'; ctx.fillRect(2,2,12,12);
            ctx.fillStyle = '#22d3ee'; ctx.fillRect(3,3,10,10);
            ctx.fillStyle = '#0ea5e9'; ctx.fillRect(5,5,6,2); ctx.fillRect(5,9,6,2);
            ctx.fillStyle = '#34d399'; ctx.fillRect(4,7,8,1);
            ctx.fillStyle = '#fcd34d'; ctx.fillRect(7,6,2,4);
        }
    };

    function renderPortraits() {
        document.querySelectorAll('.char-portrait').forEach(div => {
            const painter = spritePainters[div.dataset.sprite];
            if (!painter) return;
            const spriteCanvas = document.createElement('canvas');
            spriteCanvas.width = 64; spriteCanvas.height = 64;
            const sCtx = spriteCanvas.getContext('2d');
            sCtx.imageSmoothingEnabled = false;
            sCtx.scale(4,4);
            painter(sCtx);
            div.appendChild(spriteCanvas);
        });
    }

    renderTicker(); // Show defaults immediately
    fetchAnnouncement();
    setInterval(fetchAnnouncement, 45000); // Refresh HQ feed often for fresh AI sarcasm
    renderPortraits();
</script>
</body>
</html>






